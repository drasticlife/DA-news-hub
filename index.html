<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SEC DA Purchase Intelligence Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/globe.gl"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css"
    />
    <script>
      tailwind.config = { darkMode: "class" };
    </script>
    <style>
      /* ëœë”© í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
      #landing-page {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        z-index: 9999;
        transition: opacity 1s ease-out, visibility 1s;
        cursor: pointer;
        overflow: hidden;
      }
      #landing-page.hidden {
        opacity: 0;
        visibility: hidden;
      }
      #globeViz { width: 100vw; height: 100vh; }
    
      #center-title {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        text-align: center;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        pointer-events: none;
        z-index: 10;
        text-shadow: 0 0 10px rgba(0, 169, 224, 0.8);
      }
      
      #center-title h1 {
        margin: 0;
        font-size: 3rem;
        font-weight: 300;
        letter-spacing: 2px;
        text-transform: uppercase;
      }

      #center-title p {
        margin: 10px 0 0;
        font-size: 1.2rem;
        font-weight: 100;
        opacity: 0.8;
        font-style: italic;
      }
      
      body.landing-active {
        overflow: hidden;
      }

      body {
        font-family: "Pretendard", sans-serif;
        transition: all 0.3s ease;
      }
      .header {
        height: 55px;
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 100;
        border-bottom: 2px solid #1428a0;
      }
      .sidebar {
        width: 280px;
        position: fixed;
        left: 0;
        top: 55px;
        height: calc(100vh - 55px);
        border-right: 1px solid #eee;
        padding: 20px;
        overflow-y: auto;
        background: white;
      }
      .main-content {
        margin-left: 280px;
        margin-top: 55px;
        padding: 30px 40px;
        max-width: 1200px;
      }

      /* 1. ì•ˆì •ì ì¸ 8ì—´ ê·¸ë¦¬ë“œ ë‹¬ë ¥ (ì£¼ì°¨ í¬í•¨) */
      .calendar-grid {
        display: grid;
        grid-template-columns: 24px repeat(7, minmax(24px, 1fr));
        gap: 2px;
        align-items: center;
        justify-items: center;
        width: 100%;
        max-width: 280px;
      }
      .calendar-grid span {
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.3s ease;
        font-size: 10px;
        cursor: default;
        position: relative;
        flex-shrink: 0;
      }

      /* ì£¼ì°¨ í‘œì‹œ ìŠ¤íƒ€ì¼ */
      .week-label {
        font-size: 9px !important;
        font-weight: 700;
        color: #94a3b8;
        cursor: pointer !important;
        transition: all 0.2s;
      }
      .week-label:hover {
        color: #1428a0;
        transform: scale(1.1);
      }
      .week-selected {
        background: #1428a0 !important;
        color: white !important;
        border-radius: 4px !important;
      }

      /* ë¦¬ìŠ¤í¬ í•„í„° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
      .risk-filter-btn.active {
        background: white;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      .dark .risk-filter-btn.active {
        background: #3f444a;
      }

      /* ì–„ìŒí•œ ë§ ë””ìì¸ (LV1~LV3) */
      .calendar-ring {
        border: 1.2px solid #1428a0;
        color: #1428a0;
        font-weight: 800;
        cursor: pointer !important;
      }
      .ring-lv1 {
        width: 20px !important;
        height: 20px !important;
        border-width: 1px;
      }
      .ring-lv2 {
        width: 24px !important;
        height: 24px !important;
        border-width: 2px;
      }
      .ring-lv3 {
        width: 28px !important;
        height: 28px !important;
        border-width: 3px;
        box-shadow: 0 0 8px rgba(20, 40, 160, 0.15);
      }
      .calendar-selected {
        background-color: #1428a0 !important;
        color: white !important;
        border: none !important;
      }

      /* ë„¤ë¹„ê²Œì´ì…˜ í™”ì‚´í‘œ ìŠ¤íƒ€ì¼ */
      .nav-btn {
        cursor: pointer;
        padding: 2px;
        border-radius: 4px;
        transition: all 0.2s;
        color: #cbd5e1;
      }
      .nav-btn:hover {
        background: #f1f5f9;
        color: #1428a0;
      }

      /* 2. ë™ì  í™•ì¥ ì¹´ë“œ ë° ì´ë¯¸ì§€ íš¨ê³¼ */
      .news-item {
        border-bottom: 1px solid #f1f5f9;
        padding: 24px 0;
        cursor: pointer;
        /* Remove overflow hidden to allow outside bubble */
        position: relative; 
      }
      .news-inner {
        transition: all 0.4s ease;
        overflow: hidden;
        max-height: 240px;
        /* Ensure inner content clips properly */
      }
      /* Expanded state targets the INNER wrapper */
      .news-item.expanded .news-inner {
        max-height: 1500px;
      }
      .news-item.expanded {
        background: #fcfdfe;
        border-bottom: 2px solid #1428a0;
      }
      .summary-text {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      .news-item.expanded .summary-text {
        -webkit-line-clamp: unset;
        line-clamp: unset;
      }
      .news-item img {
        filter: grayscale(100%);
        transition: all 0.5s ease;
      }
      .news-item:hover img {
        filter: grayscale(0%);
        transform: scale(1.05);
      }

      /* Refined Premium Highlighter Style */
      article mark {
        background-color: #eef2ff !important; /* Soft indigo-tinted white */
        color: #1a237e !important; /* Deep navy */
        padding: 2px 6px;
        border-radius: 6px;
        font-weight: 600;
        box-shadow: 0 1px 2px rgba(0,0,0,0.05); /* Subtle depth */
        border: 1px solid rgba(224, 231, 255, 0.5); /* Glassy edge */
      }
      .dark article mark {
        background-color: #312e81 !important;
        color: #e0e7ff !important;
        border: 1px solid rgba(79, 70, 229, 0.3);
      }
      
      article b, article strong {
        color: #1428a0 !important; /* Brand Blue */
        font-weight: 800;
        font-size: 1.2em !important; /* Increased for better visibility */
        letter-spacing: -0.01em;
      }
      .dark article b, .dark article strong {
        color: #93c5fd !important; /* Brighter blue for dark mode */
      }

      /* 3D ì¸í„°ë™í‹°ë¸Œ íƒœê·¸ í´ë¼ìš°ë“œ - ìˆœìˆ˜ JS êµ¬í˜„ */
      #tagCloudContainer {
        position: relative;
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        border-radius: 8px;
        overflow: hidden;
        perspective: 600px;
      }
      #tagCloud3D {
        width: 100%;
        height: 200px;
        position: relative;
        transform-style: preserve-3d;
      }
      .tag3d {
        position: absolute;
        left: 50%;
        top: 50%;
        font-size: 12px;
        font-weight: 600;
        color: #e2e8f0;
        cursor: pointer;
        transition: color 0.3s;
        white-space: nowrap;
        user-select: none;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        transform-origin: center center;
        will-change: transform, opacity;
      }
      .tag3d:hover {
        color: #60a5fa;
        transform: scale(1.2) !important;
        text-shadow: 0 0 10px rgba(96, 165, 250, 0.6);
      }

      /* ê¸€ë¡œë²Œ ì§€ë„ ìŠ¤íƒ€ì¼ */
      #worldMap {
        width: 100%;
        height: 130px;
        background: #f8fafc;
        border-radius: 8px;
        position: relative;
        overflow: hidden;
      }
      .country-marker {
        position: absolute;
        width: 10px;
        height: 10px;
        background: #1428a0;
        border: 2px solid white;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }
      .country-marker:hover {
        transform: scale(1.5);
        z-index: 10;
      }
      .country-marker::after {
        content: attr(data-country);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: #1428a0;
        color: white;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 9px;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
        margin-bottom: 4px;
      }
      .country-marker:hover::after {
        opacity: 1;
      }

      /* í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ */
      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.3);
          opacity: 0.7;
        }
      }

      /* í™˜ìœ¨/ì›ìì¬ ìŠ¬ë¼ì´ë“œ ìŠ¤íƒ€ì¼ */
      .market-section {
        margin-bottom: 20px;
        background: #f8fafc;
        border-radius: 8px;
        padding: 12px;
        position: relative;
        overflow: hidden;
        height: 80px;
      }
      .market-carousel {
        display: flex;
        transition: transform 0.5s ease-in-out;
      }
      .market-slide {
        min-width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
      }
      .market-label {
        font-weight: 600;
        color: #64748b;
        font-size: 10px;
      }
      .market-value {
        font-weight: 700;
        color: #1428a0;
        font-size: 12px;
      }
      .market-change {
        font-size: 9px;
        padding: 2px 6px;
        border-radius: 4px;
        margin-top: 4px;
        display: inline-block;
      }
      .market-up {
        color: #dc2626;
        background: #fee2e2;
      }
      .market-down {
        color: #2563eb;
        background: #dbeafe;
      }
      .carousel-dots {
        display: flex;
        justify-content: center;
        gap: 4px;
        margin-top: 8px;
      }
      .carousel-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #cbd5e1;
        cursor: pointer;
        transition: all 0.3s;
      }
      .carousel-dot.active {
        background: #1428a0;
        width: 12px;
        border-radius: 3px;
      }

      /* URL ì¶œì²˜ ë§í¬ ìŠ¤íƒ€ì¼ */
      .source-links {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 8px;
      }
      .source-link {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 10px;
        background: #f1f5f9;
        border-radius: 12px;
        font-size: 10px;
        font-weight: 600;
        color: #1428a0;
        text-decoration: none;
        transition: all 0.2s;
      }
      .source-link:hover {
        background: #1428a0;
        color: white;
        transform: translateY(-1px);
      }

      .dark body {
        background-color: #1a1c1e;
        color: #e2e8f0;
      }
      .dark .header,
      .dark .sidebar,
      .dark .news-item {
        background-color: #25282c;
        border-color: #3f444a;
      }
      
      /* Investing.com ìœ„ì ¯ ë§ˆìŠ¤í‚¹ ìŠ¤íƒ€ì¼ ì œê±°ë¨ */
      /* Index Modal Styles */
      #indexModal .tradingview-widget-copyright {
        display: none !important;
      }

      /* Bot Bubble UI */
      .bot-container {
        position: absolute;
        top: 16px;
        right: 16px;
        z-index: 20;
      }
      .bot-icon {
        font-size: 24px;
        cursor: pointer;
        transition: transform 0.2s;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
      }
      .bot-icon:hover {
        transform: scale(1.2) rotate(-10deg);
      }
      /* Improved Bot Layout (In-Card) */
      .news-body-grid {
        display: flex;
        gap: 24px;
        align-items: flex-start;
      }
      .news-content-col {
        flex: 1; /* Takes almost all space by default or 70% if bot exists */
        min-width: 0; /* Prevent flex overflow */
      }
      .news-bot-col {
        width: 260px; /* Fixed width for bot side */
        flex-shrink: 0;
        display: none;
        padding-top: 8px;
        opacity: 0;
        transform: translateX(10px);
        transition: all 0.4s ease 0.1s;
      }
      /* Only show bot column when expanded and it exists */
      .news-item.expanded .news-bot-col {
        display: block;
        opacity: 1;
        transform: translateX(0);
      }
      
      .bot-inner-bubble {
        background: #fff0f5;
        border: 2px solid #ffb6c1;
        border-radius: 12px;
        border-top-left-radius: 2px;
        padding: 16px;
        font-size: 13px;
        color: #d63384;
        line-height: 1.6;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        position: relative;
      }
      .bot-inner-bubble::before {
        content: "ğŸ¤–";
        position: absolute;
        top: -14px;
        left: -8px;
        font-size: 24px;
        filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1));
      }

      /* Dark mode adjustment */


    </style>
  </head>
  <body class="bg-[#fcfcfc] text-[#333] landing-active">
    <!-- 3D ì§€êµ¬ ëœë”© í˜ì´ì§€ -->
    <div id="landing-page" onclick="enterDashboard()">
      <div id="center-title">
        <h1>DA Procurement</h1>
        <p>Daily Insight Journal</p>
      </div>

      <div id="globeViz"></div>
    </div>

    <script>
      function initLandingGlobe() {
        // [ë°ì´í„° ì„¤ì •]
        // lat/lng: ì‹¤ì œ ê³µì¥ ìœ„ì¹˜
        // txtLat/txtLng: ê¸€ìê°€ í‘œì‹œë  ìœ„ì¹˜ (ê²¹ì¹¨ ë°©ì§€ìš©)
        const places = [
          // 1. í•œêµ­ (ìˆ˜ì› vs ê´‘ì£¼ ìƒí•˜ ë¶„ë¦¬)
          { name: "Samsung Digital City", country: "Korea", product: "HQ / R&D", lat: 37.263, lng: 127.028, txtLat: 39.5, txtLng: 127.0 },
          { name: "Gwangju Plant", country: "Korea", product: "Premium DA", lat: 35.159, lng: 126.852, txtLat: 33.5, txtLng: 127.5 },

          // 2. ì¤‘êµ­ (ì‹ ê·œ ì¶”ê°€) - í•œêµ­ê³¼ ê²¹ì¹˜ì§€ ì•Šê²Œ ì™¼ìª½(ì„œìª½)ìœ¼ë¡œ ê¸€ì ì´ë™
          { name: "SSEC", country: "China", product: "DA Complex", lat: 31.298, lng: 120.585, txtLat: 31.3, txtLng: 116.0 },
          
          // 3. ë™ë‚¨ì•„ (íƒœêµ­ vs ë² íŠ¸ë‚¨ ëŒ€ê°ì„  ë¶„ë¦¬)
          { name: "TSE", country: "Thailand", product: "A/C, Ref", lat: 13.111, lng: 100.927, txtLat: 16.5, txtLng: 98.0 },
          { name: "SEHC", country: "Vietnam", product: "TV/DA Complex", lat: 10.762, lng: 106.660, txtLat: 8.5, txtLng: 109.0 },

          // 4. ë‚¨ë¯¸ (ì‹ ê·œ ì¶”ê°€) - ë¸Œë¼ì§ˆ
          { name: "SEDA", country: "Brazil", product: "DA/TV", lat: -3.119, lng: -60.021, txtLat: -3.119, txtLng: -60.021 },

          // 5. ê·¸ ì™¸ ì§€ì—­
          { name: "SEPM", country: "Poland", product: "Ref/W/M", lat: 52.711, lng: 16.381, txtLat: 52.711, txtLng: 16.381 },
          { name: "SAMEX", country: "Mexico", product: "Ref", lat: 20.588, lng: -100.389, txtLat: 20.588, txtLng: -100.389 },
          { name: "SEM", country: "Mexico", product: "TV/Monitor", lat: 32.514, lng: -117.038, txtLat: 32.514, txtLng: -117.038 },
          { name: "SEHA", country: "USA", product: "W/M", lat: 34.274, lng: -81.618, txtLat: 34.274, txtLng: -81.618 },
          { name: "SIEL", country: "India", product: "DA/TV", lat: 12.971, lng: 80.015, txtLat: 12.971, txtLng: 80.015 }
        ];

        const world = Globe()
          (document.getElementById('globeViz'))
          .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
          .bumpImageUrl('https://unpkg.com/three-globe/example/img/earth-topology.png')
          .backgroundImageUrl('https://unpkg.com/three-globe/example/img/night-sky.png')
          .atmosphereColor('#3a228a')
          .atmosphereAltitude(0.2)

          // [ì ]
          .pointsData(places)
          .pointLat('lat')
          .pointLng('lng')
          .pointColor(() => '#00a9e0')
          .pointAltitude(0.01)
          .pointRadius(0.6)
          
          // [ê¸€ì]
          .labelsData(places)
          .labelLat('txtLat')
          .labelLng('txtLng')
          .labelText(d => `${d.name}\n${d.country} | ${d.product}`)
          .labelSize(1.0)
          .labelDotRadius(0.3)
          .labelColor(() => 'rgba(255, 255, 255, 0.9)')
          .labelResolution(2)
          .labelAltitude(0.02)

          .onPointClick(point => {
            // í´ë¦­ ì‹œ ë” ê°€ê¹Œì´ ì¤Œì¸
            world.pointOfView({ lat: point.lat, lng: point.lng, altitude: 1.5 }, 1000);
          });

        // [ì´ˆê¸° ì‹œì  ì„¤ì •] 
        // altitude ê°’ì„ 1.8 -> 1.4ë¡œ ë‚®ì¶°ì„œ ë” í™•ëŒ€ëœ ìƒíƒœë¡œ ì‹œì‘
        world.pointOfView({ lat: 25, lng: 110, altitude: 1.1 });

        world.controls().autoRotate = true;
        world.controls().autoRotateSpeed = 0.6;
      }

      function enterDashboard() {
        const lp = document.getElementById('landing-page');
        lp.classList.add('hidden');
        document.body.classList.remove('landing-active');
        
        // Stop the heavy 3D globe rendering
        setTimeout(() => { 
            lp.style.display = 'none';
            const globeContainer = document.getElementById('globeViz');
            if(globeContainer) {
                globeContainer.innerHTML = ''; // Kill the WebGL context
            }
        }, 1000);
      }

      // DOM ë¡œë“œ ì‹œ ì§€êµ¬ë³¸ ì´ˆê¸°í™”
      document.addEventListener('DOMContentLoaded', () => {
        initLandingGlobe();
      });
    </script>

    <header
      class="header flex items-center px-6 justify-between bg-white dark:bg-[#25282c] shadow-sm"
    >
      <div class="flex items-center gap-6">
        <div
          class="flex items-center gap-2 cursor-pointer"
          onclick="location.reload()"
        >
          <div
            class="w-7 h-7 bg-[#1428a0] rounded flex items-center justify-center text-white font-bold text-xs shadow-sm"
          >
            DA
          </div>
          <h1
            class="text-base font-black text-[#1428a0] dark:text-blue-400 tracking-tighter uppercase whitespace-nowrap"
          >
            Purchase Intelligence
          </h1>
        </div>
        <nav class="hidden md:flex items-center gap-4 lg:gap-6 text-sm font-bold text-slate-400 whitespace-nowrap">
          <a href="#" onclick="resetFilters()" id="nav-all">ì „ëµ ì‹œí™©</a>
          <a href="#" onclick="filterNews('ì›ìì¬')">ì›ìì¬</a>
          <a href="#" onclick="filterNews('ê±°ì‹œê²½ì œ')">ê±°ì‹œ/ì •ì±…</a>
          <a href="#" onclick="filterNews('ìƒì‚°ì§€ì—­')">ìƒì‚°ì§€ì—­</a>
          <a href="#" onclick="filterNews('ê²½ìŸì‚¬')">ê²½ìŸì‚¬</a>
          <a href="#" onclick="filterNews('ì‹ ê¸°ìˆ ë™í–¥')">ì‹ ê¸°ìˆ ë™í–¥</a>
          <a href="#" onclick="showIndexModal()">INDEX</a>
        </nav>
      </div>
      <div class="flex items-center gap-2 flex-1 max-w-md mx-8">
        <select
          id="searchScope"
          onchange="handleSearchScope(event)"
          class="bg-gray-50 dark:bg-gray-800 border-none rounded-lg py-1.5 px-3 text-xs font-bold text-gray-500 focus:ring-2 focus:ring-[#1428a0] outline-none cursor-pointer h-[34px]"
        >
          <option value="all">ì œëª©+ë³¸ë¬¸</option>
          <option value="title">ì œëª©</option>
          <option value="content">ë³¸ë¬¸</option>
        </select>
        <div class="relative w-full">
          <i
            data-lucide="search"
            class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
          ></i>
          <input
            type="text"
            id="searchInput"
            onkeyup="handleSearch(event)"
            placeholder="ë‰´ìŠ¤ í‚¤ì›Œë“œ ê²€ìƒ‰..."
            class="w-full bg-gray-50 dark:bg-gray-800 border-none rounded-full py-1.5 pl-10 pr-4 text-sm focus:ring-2 focus:ring-[#1428a0] transition-all outline-none"
          />
        </div>
      </div>
      <div class="flex items-center gap-2">
        <button
          onclick="toggleLanguage()"
          id="langBtn"
          class="px-2 py-1 rounded text-[10px] font-bold bg-gray-100 dark:bg-gray-700 text-slate-500 hover:text-[#1428a0] transition-colors"
        >
          KO
        </button>
        <button
          onclick="toggleDarkMode()"
          class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
        >
          <i data-lucide="moon" id="themeIcon" class="w-4 h-4 text-gray-500"></i>
        </button>
      </div>
    </header>

    <aside class="sidebar dark:bg-[#25282c]">
      <!-- ë‹¬ë ¥ ì„¹ì…˜ -->
      <div class="mb-8">
        <h3
          class="text-[10px] font-black mb-4 dark:text-gray-200 uppercase tracking-widest text-slate-400 flex justify-between items-center"
        >
          <span onclick="goToday()" class="cursor-pointer hover:text-[#1428a0] transition-colors">TODAY</span>
          <div
            class="flex items-center gap-1 bg-gray-50 dark:bg-gray-800 px-2 py-1 rounded-md"
          >
            <i
              data-lucide="chevrons-left"
              class="w-3 h-3 nav-btn"
              onclick="moveCalendar(-1, 0)"
            ></i>
            <i
              data-lucide="chevron-left"
              class="w-3 h-3 nav-btn"
              onclick="moveCalendar(0, -1)"
            ></i>
            <span
              id="calHeader"
              class="text-[10px] font-bold text-[#1428a0] min-w-[55px] text-center"
              >2026. 01</span
            >
            <i
              data-lucide="chevron-right"
              class="w-3 h-3 nav-btn"
              onclick="moveCalendar(0, 1)"
            ></i>
            <i
              data-lucide="chevrons-right"
              class="w-3 h-3 nav-btn"
              onclick="moveCalendar(1, 0)"
            ></i>
          </div>
        </h3>
        <div id="calendarGrid" class="calendar-grid text-slate-400"></div>
      </div>

      <!-- ê¸€ë¡œë²Œ ì§€ë„ ì„¹ì…˜ -->
      <div class="mb-8">
        <h3
          class="text-[10px] font-black mb-4 dark:text-gray-200 uppercase tracking-widest text-slate-400"
        >
          Global Map
        </h3>
        <div id="worldMap"></div>
      </div>

      <!-- 3D Tag Cloud Section -->
      <div class="mb-8">
        <h3 class="text-[10px] font-black mb-4 dark:text-gray-200 uppercase tracking-widest text-slate-400">
            Trend Keywords
        </h3>
        <div id="tagCloudContainer">
            <div id="tagCloud3D"></div>
        </div>
      </div>

      <!-- TradingView Tickers Widget -->
      <div class="mb-4">
        <!-- TradingView Widget BEGIN -->
      <!-- Vertical Carousel Widget -->
      <style>
        .carousel-container {
          width: 100%;
          height: 126px; /* Single widget height */
          overflow: hidden;
          position: relative;
          background: transparent;
        }
        .carousel-track {
          display: flex;
          flex-direction: column;
          transition: transform 0.8s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .carousel-item {
          height: 126px;
          width: 100%;
          flex-shrink: 0;
        }
        /* Hide TradingView copyright for cleaner look */
        .carousel-item .tradingview-widget-copyright {
          display: none !important;
        }
      </style>

      <div class="carousel-container mb-4">
        <div class="carousel-track" id="ticker-track">
          <!-- 1. USDKRW -->
          <div class="carousel-item">
            <div class="tradingview-widget-container">
              <div class="tradingview-widget-container__widget"></div>
              <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
              {
                "symbol": "FX_IDC:USDKRW",
                "width": "100%",
                "colorTheme": "light",
                "isTransparent": true,
                "locale": "kr"
              }
              </script>
            </div>
          </div>
          <!-- 2. USDCNY -->
          <div class="carousel-item">
            <div class="tradingview-widget-container">
              <div class="tradingview-widget-container__widget"></div>
              <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
              {
                "symbol": "FX_IDC:USDCNY",
                "width": "100%",
                "colorTheme": "light",
                "isTransparent": true,
                "locale": "kr"
              }
              </script>
            </div>
          </div>
          <!-- 3. USDTHB -->
          <div class="carousel-item">
            <div class="tradingview-widget-container">
              <div class="tradingview-widget-container__widget"></div>
              <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
              {
                "symbol": "FX_IDC:USDTHB",
                "width": "100%",
                "colorTheme": "light",
                "isTransparent": true,
                "locale": "kr"
              }
              </script>
            </div>
          </div>
          <!-- 4. USDINR -->
          <div class="carousel-item">
            <div class="tradingview-widget-container">
              <div class="tradingview-widget-container__widget"></div>
              <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
              {
                "symbol": "FX_IDC:USDINR",
                "width": "100%",
                "colorTheme": "light",
                "isTransparent": true,
                "locale": "kr"
              }
              </script>
            </div>
          </div>
          <!-- 5. USDBRL -->
          <div class="carousel-item">
            <div class="tradingview-widget-container">
              <div class="tradingview-widget-container__widget"></div>
              <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
              {
                "symbol": "FX_IDC:USDBRL",
                "width": "100%",
                "colorTheme": "light",
                "isTransparent": true,
                "locale": "kr"
              }
              </script>
            </div>
        (function() {
          // Initialize carousel if container exists
          const track = document.getElementById('ticker-track');
          if (track) {
            const items = track.children;
            const itemCount = items.length;
            const itemHeight = 126;
            let index = 0;

            setInterval(() => {
              index++;
              if (index >= itemCount) {
                index = 0;
              }
              track.style.transform = `translateY(-${index * itemHeight}px)`;
            }, 4000); 
          }
        })();
      </script>
        <!-- TradingView Widget END -->
      </div>

      <!-- 3D íƒœê·¸ í´ë¼ìš°ë“œ ì„¹ì…˜ -->
      <div>
        <h3
          class="text-[10px] font-black mb-4 dark:text-gray-200 uppercase tracking-widest text-slate-400"
        >
          Intelligence Cloud
        </h3>
        <div id="tagCloudContainer" style="width: 100%; height: 200px">
          <div id="tagCloud3D"></div>
        </div>
      </div>
    </aside>

    <main class="main-content">
      <div class="grid grid-cols-3 gap-6 mb-10" id="summaryGrid"></div>
      <div
        class="flex justify-between items-center mb-6 pb-2 border-b dark:border-gray-700"
      >
        <h2 class="font-bold text-lg" id="feedTitle">Strategic Feed</h2>
        <div class="flex items-center gap-4">
          <div
            class="flex items-center gap-2 bg-slate-50 dark:bg-slate-800/50 p-1 rounded-lg"
          >
            <span class="text-[9px] px-2 text-slate-400">RISK:</span>
            <button
              onclick="filterByRisk('all')"
              class="risk-filter-btn active px-2 py-0.5 rounded text-[9px] font-bold hover:bg-white dark:hover:bg-slate-700 transition-all"
            >
              ALL
            </button>
            <button
              onclick="filterByRisk('High')"
              class="risk-filter-btn px-2 py-0.5 rounded text-[9px] font-bold text-red-500 hover:bg-white dark:hover:bg-slate-700 transition-all"
            >
              HIGH
            </button>
            <button
              onclick="filterByRisk('Med')"
              class="risk-filter-btn px-2 py-0.5 rounded text-[9px] font-bold text-orange-500 hover:bg-white dark:hover:bg-slate-700 transition-all"
            >
              MED
            </button>
            <button
              onclick="filterByRisk('Low')"
              class="risk-filter-btn px-2 py-0.5 rounded text-[9px] font-bold text-blue-500 hover:bg-white dark:hover:bg-slate-700 transition-all"
            >
              LOW
            </button>
          </div>
          <div
            class="text-[10px] flex gap-4 uppercase font-bold text-slate-400 border-l pl-4 dark:border-gray-700"
          >
            <span
              id="sortLatest"
              class="cursor-pointer text-[#1428a0]"
              onclick="sortNews('latest')"
              >Latest</span
            >
            <span
              id="sortOldest"
              class="cursor-pointer hover:text-[#1428a0]"
              onclick="sortNews('oldest')"
              >Oldest</span
            >
          </div>
        </div>
      </div>
      <div
        id="loading"
        class="py-20 text-center animate-pulse text-blue-600 font-bold text-[10px] tracking-widest"
      >
        SYNCING DATA...
      </div>
      <div id="news-feed" class="space-y-4"></div>
    </main>

    <div
      id="reportModal"
      class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-[1000]"
    >
      <div
        class="modal-content bg-white dark:bg-[#25282c] w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden transition-all duration-300 transform translate-y-4"
      >
        <div
          class="p-6 border-b dark:border-gray-700 flex justify-between items-center bg-[#1428a0] text-white"
        >
          <h3 class="font-bold text-lg flex items-center gap-2">
            <i data-lucide="file-text" class="w-5 h-5"></i> <span id="modalTitleText">ì „ëµ ìš”ì•½ ë³´ê³ ì„œ</span>
          </h3>
          <button
            onclick="closeModal()"
            class="hover:bg-white/20 p-1 rounded-full"
          >
            <i data-lucide="x" class="w-6 h-6"></i>
          </button>
        </div>
        <div
          id="modalBody"
          class="p-8 max-h-[70vh] overflow-y-auto space-y-6"
        ></div>
      </div>
    </div>

    <!-- Dynamic Report Modal -->
    <div id="reportModal" class="modal-overlay hidden" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div id="modalBody"></div>
            <button class="close-btn" onclick="closeModal()">
                <i data-lucide="x"></i>
            </button>
        </div>
    </div>
    
    <!-- Global Bot Follower Element -->
    <div id="global-bot-follower" class="fixed hidden bg-white dark:bg-[#25282c] p-3 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 text-sm text-gray-700 dark:text-gray-300 max-w-xs z-[1001] pointer-events-none transition-opacity duration-150"></div>

    <script>
      const GAS_URL = "https://script.google.com/macros/s/AKfycbzNJA_s6YGI2Blt6b_gaDLbOFbyzqIl7c4MDlFUjoKjDn8uCQrpkXtSba4-FHVL7HVJ7g/exec";
      const GITHUB_DATA_URL = "https://raw.githubusercontent.com/drasticlife/DA-news-hub/main/data.json";
      
      let allNews = [],
        currentFilteredNews = [];
      
      // í†µí•© í•„í„° ìƒíƒœ ê´€ë¦¬
      let filterState = {
        category: "all",
        risk: "all",
        sort: "latest",
        search: "",
        scope: "all",
        dateType: null, // null | 'week' | 'day'
        dateValue: null,
        country: "all",
        tag: "all"
      };

      // ì–¸ì–´ ìƒíƒœ ë° ë²ˆì—­ ì‚¬ì „
      let currentLang = 'ko'; // 'ko' | 'en'
      const translations = {
        ko: {
          nav_strategy: "ì „ëµ ì‹œí™©",
          nav_material: "ì›ìì¬",
          nav_macro: "ê±°ì‹œ/ì •ì±…",
          nav_region: "ìƒì‚°ì§€ì—­",
          nav_competitor: "ê²½ìŸì‚¬",
          nav_tech: "ì‹ ê¸°ìˆ ë™í–¥",
          nav_index: "INDEX",
          search_scope_all: "ì œëª©+ë³¸ë¬¸",
          search_scope_title: "ì œëª©",
          search_scope_content: "ë³¸ë¬¸",
          search_placeholder: "ë‰´ìŠ¤ í‚¤ì›Œë“œ ê²€ìƒ‰...",
          today: "TODAY",
          global_map: "Global Map",
          cloud_title: "Intelligence Cloud",
          feed_title: "Strategic Feed",
          risk_all: "ALL",
          sort_latest: "Latest",
          sort_oldest: "Oldest",
          syncing: "SYNCING DATA...",
          modal_title: "ì „ëµ ìš”ì•½ ë³´ê³ ì„œ",
          country_news_suffix: " ê´€ë ¨ ë‰´ìŠ¤",
          data_error: "ë°ì´í„° ì—†ìŒ",
          tag_data_error: "íƒœê·¸ ë°ì´í„° ì—†ìŒ",
          region_data_error: "ì§€ì—­ ë°ì´í„° ì—†ìŒ",
          briefing_suffix: " ì „ëµ ë¸Œë¦¬í•‘"
        },
        en: {
          nav_strategy: "Strategy",
          nav_material: "Material",
          nav_macro: "Macro",
          nav_region: "Region",
          nav_competitor: "Competitors", 
          nav_tech: "New Tech",
          nav_index: "Index",
          search_scope_all: "Title+Content",
          search_scope_title: "Title",
          search_scope_content: "Content",
          search_placeholder: "Search keywords...",
          today: "TODAY",
          global_map: "Global Map",
          cloud_title: "Intelligence Cloud",
          feed_title: "Strategic Feed",
          risk_all: "ALL",
          sort_latest: "Latest",
          sort_oldest: "Oldest",
          syncing: "SYNCING DATA...",
          modal_title: "Strategy Summary Report",
          country_news_suffix: " News",
          data_error: "No Data",
          tag_data_error: "No Tag Data",
          region_data_error: "No Regional Data",
          briefing_suffix: " Briefing"
        }
      };

      function toggleLanguage() {
        currentLang = currentLang === 'ko' ? 'en' : 'ko';
        document.getElementById('langBtn').innerText = currentLang.toUpperCase();
        
        applyTranslations();
        renderAllow(); // Re-render content
      }

      function applyTranslations() {
        const t = translations[currentLang];
        
        // Static UI Elements (Update logic)
        // Note: For cleaner code, we will select elements by ID or data-i18n in a separate pass strictly if needed,
        // but for now we'll update specific IDs directly or re-render components that contain them.

        // Navbar
        const navLinks = document.querySelectorAll('nav a');
        if(navLinks.length >= 7) {
            navLinks[0].innerText = t.nav_strategy;
            navLinks[1].innerText = t.nav_material;
            navLinks[2].innerText = t.nav_macro;
            navLinks[3].innerText = t.nav_region;
            navLinks[4].innerText = t.nav_competitor;
            navLinks[5].innerText = t.nav_tech;
            navLinks[6].innerText = t.nav_index;
        }

        // Search Scope
        const scopeOpts = document.getElementById('searchScope').options;
        scopeOpts[0].text = t.search_scope_all;
        scopeOpts[1].text = t.search_scope_title;
        scopeOpts[2].text = t.search_scope_content;
        
        // Search Placeholder
        document.getElementById('searchInput').placeholder = t.search_placeholder;

        // Feed Title (Default)
        if(document.getElementById('feedTitle').innerText === translations['ko'].feed_title || 
           document.getElementById('feedTitle').innerText === translations['en'].feed_title) {
            document.getElementById('feedTitle').innerText = t.feed_title;
        }

        // Modal Title
        const modalTitle = document.getElementById('modalTitleText');
        if(modalTitle) modalTitle.innerText = t.modal_title;

        // Loading Text
        const loadingEl = document.getElementById('loading');
        if(loadingEl) loadingEl.innerText = t.syncing;
      }

      function renderAllow() {
          renderAll(currentFilteredNews); // Re-use the existing renderAll logic but with current data
      }

      const todayDate = new Date();
      let curYear = todayDate.getFullYear(),
        curMonth = todayDate.getMonth();
      let tagCloudInstance = null;

      // êµ­ê°€ ì¢Œí‘œ ë§µí•‘ (ì‹¤ì œ ì„¸ê³„ ì§€ë„ ì´ë¯¸ì§€ ê¸°ì¤€, %)
      // í‘œì¤€ ë©”ë¥´ì¹´í† ë¥´ íˆ¬ì˜ë²• - ì •í™•í•œ ì‹¤ì œ ìœ„ì¹˜
      const countryCoords = {
        // ë¶ë¯¸
        ë¯¸êµ­: { x: 22, y: 38 },
        USA: { x: 22, y: 38 },
        ìºë‚˜ë‹¤: { x: 20, y: 25 },
        Canada: { x: 20, y: 25 },
        ë©•ì‹œì½”: { x: 18, y: 48 },
        Mexico: { x: 18, y: 48 },

        // ë‚¨ë¯¸
        ë¸Œë¼ì§ˆ: { x: 32, y: 68 },
        Brazil: { x: 32, y: 68 },

        // ìœ ëŸ½
        ì˜êµ­: { x: 48, y: 30 },
        UK: { x: 48, y: 30 },
        "United Kingdom": { x: 48, y: 30 },
        í”„ë‘ìŠ¤: { x: 50, y: 34 },
        France: { x: 50, y: 34 },
        ë…ì¼: { x: 52, y: 32 },
        Germany: { x: 52, y: 32 },
        ì´íƒˆë¦¬ì•„: { x: 53, y: 36 },
        Italy: { x: 53, y: 36 },
        ìŠ¤í˜ì¸: { x: 47, y: 37 },
        Spain: { x: 47, y: 37 },
        ëŸ¬ì‹œì•„: { x: 70, y: 25 },
        Russia: { x: 70, y: 25 },

        // ì•„ì‹œì•„
        ì¤‘êµ­: { x: 76, y: 40 },
        China: { x: 76, y: 40 },
        ì¼ë³¸: { x: 86, y: 38 },
        Japan: { x: 86, y: 38 },
        í•œêµ­: { x: 82, y: 38 },
        Korea: { x: 82, y: 38 },
        "South Korea": { x: 82, y: 38 },
        ì¸ë„: { x: 67, y: 45 },
        India: { x: 67, y: 45 },
        ë² íŠ¸ë‚¨: { x: 78, y: 50 },
        Vietnam: { x: 78, y: 50 },
        íƒœêµ­: { x: 76, y: 50 },
        Thailand: { x: 76, y: 50 },
        ì¸ë„ë„¤ì‹œì•„: { x: 80, y: 58 },
        Indonesia: { x: 80, y: 58 },

        // ì˜¤ì„¸ì•„ë‹ˆì•„
        í˜¸ì£¼: { x: 85, y: 75 },
        Australia: { x: 85, y: 75 },

        // ì „ì—­
        Global: { x: 50, y: 50 },
      };

      // ì² í†µ ë‚ ì§œ íŒŒì‹±
      function parseDate(dateStr) {
        if (!dateStr) return new Date();
        const clean = dateStr.toString().replace(/\./g, "-").replace(/\s/g, "");
        const parts = clean.split("T")[0].split("-");
        return parts.length < 3
          ? new Date()
          : new Date(parts[0], parts[1] - 1, parts[2]);
      }

      // ì£¼ì°¨ ê³„ì‚° í•¨ìˆ˜
      function getWeekOfMonth(date) {
        const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
        const dayOfMonth = date.getDate();
        const firstDayOfWeek = firstDay.getDay();
        return Math.ceil((dayOfMonth + firstDayOfWeek) / 7);
      }

      // ë‚ ì§œ ë²”ìœ„ë¡œ í•„í„°ë§
      function getDateRangeForWeek(year, month, weekNum) {
        const firstDay = new Date(year, month, 1);
        const firstDayOfWeek = firstDay.getDay();

        const startDate = (weekNum - 1) * 7 - firstDayOfWeek + 1;
        const endDate = startDate + 6;

        return {
          start: Math.max(1, startDate),
          end: Math.min(endDate, new Date(year, month + 1, 0).getDate()),
        };
      }

      async function fetchNews() {
        const sources = [
          { name: 'Local JSON', url: 'data.json' },
          { name: 'GitHub JSON', url: GITHUB_DATA_URL },
          { name: 'Google Sheets (GAS)', url: GAS_URL }
        ];

        let success = false;

        for (const source of sources) {
          try {
            console.log(`Attempting to fetch from ${source.name}...`);
            const res = await fetch(source.url);
            
            if (res.ok) {
              allNews = await res.json();
              console.log(`Successfully loaded news from ${source.name}:`, allNews.length, "items");
              success = true;
              break;
            } else {
              console.warn(`Failed to fetch from ${source.name}: ${res.status} ${res.statusText}`);
            }
          } catch (e) {
            console.error(`Error fetching from ${source.name}:`, e);
          }
        }

        if (success) {
          // ê³ ìœ  ID ë¶€ì—¬
          allNews.forEach((n, i) => {
            n._uId = `news-${i}-${Math.random().toString(36).substr(2, 9)}`;
          });
          
          currentFilteredNews = [...allNews];
          renderAll(allNews);
          sortNews("latest");
        } else {
          document.getElementById("loading").innerHTML = "ERROR LOADING DATA<br><span style='font-size:9px; font-weight:400;'>ëª¨ë“  ë°ì´í„° ì†ŒìŠ¤(Local, GitHub, GAS)ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</span>";
        }
        
        document.getElementById("loading").style.display = "none";
      }

      function renderAll(data) {
        renderCalendar(data);
        renderSummary(data);
        renderTags(data);
        renderWorldMap(data);
        renderFeed(data);
      }

      function moveCalendar(yOff, mOff) {
        curYear += yOff;
        curMonth += mOff;
        if (curMonth > 11) {
          curMonth = 0;
          curYear++;
        }
        if (curMonth < 0) {
          curMonth = 11;
          curYear--;
        }

        document.getElementById("calHeader").innerText =
          `${curYear}. ${String(curMonth + 1).padStart(2, "0")}`;
        renderCalendar(allNews);
      }

      function renderCalendar(data) {
        const grid = document.getElementById("calendarGrid");
        const dateCounts = data.reduce((acc, n) => {
          const d = parseDate(n.Date);
          if (d.getFullYear() === curYear && d.getMonth() === curMonth) {
            const day = d.getDate();
            acc[day] = (acc[day] || 0) + 1;
          }
          return acc;
        }, {});

        let html = "";

        // í—¤ë”: ì£¼ì°¨ + ìš”ì¼
        html += `<span class="font-bold opacity-30 text-[9px]">W</span>`;
        ["S", "M", "T", "W", "T", "F", "S"].forEach(
          (s) =>
            (html += `<span class="font-bold opacity-30 text-[10px]">${s}</span>`),
        );

        const firstDay = new Date(curYear, curMonth, 1).getDay();
        const lastDate = new Date(curYear, curMonth + 1, 0).getDate();

        let currentWeek = 1;
        let dayCount = 0;

        // ì²« ì£¼
        html += `<span class="week-label" id="week-${currentWeek}" onclick="filterByWeek(${currentWeek})">W${currentWeek}</span>`;

        // ì²« ì£¼ì˜ ë¹ˆ ì¹¸
        for (let i = 0; i < firstDay; i++) {
          html += `<span class="invisible">-</span>`;
          dayCount++;
        }

        // ë‚ ì§œ ë Œë”ë§
        for (let d = 1; d <= lastDate; d++) {
          // ìƒˆë¡œìš´ ì£¼ ì‹œì‘ (ì¼ìš”ì¼)
          if (dayCount > 0 && dayCount % 7 === 0) {
            currentWeek++;
            html += `<span class="week-label" id="week-${currentWeek}" onclick="filterByWeek(${currentWeek})">W${currentWeek}</span>`;
          }

          const count = dateCounts[d] || 0;
          let lv =
            count >= 3
              ? "calendar-ring ring-lv3"
              : count === 2
                ? "calendar-ring ring-lv2"
                : count === 1
                  ? "calendar-ring ring-lv1"
                  : "";
          const clickEvent = count > 0 ? `onclick="filterByDate(${d})"` : "";
          html += `<span class="${lv}" id="cal-${d}" ${clickEvent}>${d}</span>`;
          dayCount++;
        }

        // ë§ˆì§€ë§‰ ì£¼ì˜ ë¹ˆ ì¹¸
        const remainingCells = dayCount % 7;
        if (remainingCells !== 0) {
          for (let i = remainingCells; i < 7; i++) {
            html += `<span class="invisible">-</span>`;
          }
        }

        grid.innerHTML = html;
      }

      function filterByWeek(weekNum) {
        // ëª¨ë“  ì„ íƒ í•´ì œ
        document.querySelectorAll(".calendar-grid .week-label").forEach((el) => {
          el.classList.remove("week-selected");
        });

        // ì£¼ì°¨ ë¼ë²¨ ì„ íƒ í‘œì‹œ
        const weekLabel = document.getElementById(`week-${weekNum}`);
        if (weekLabel) weekLabel.classList.add("week-selected");

        // ë‚ ì§œ ì„ íƒ ìƒíƒœë©´ í•´ì œ (ì£¼ì°¨ì™€ ì¼ìëŠ” ìƒì¶©)
        document.querySelectorAll(".calendar-grid span:not(.week-label)").forEach((el) => {
          el.classList.remove("calendar-selected");
        });

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        filterState.dateType = 'week';
        filterState.dateValue = weekNum;
        applyFilters();
      }

      function filterByDate(day) {
        document.querySelectorAll(".calendar-grid span").forEach((el) => {
          el.classList.remove("calendar-selected", "week-selected");
        });
        const target = document.getElementById(`cal-${day}`);
        if (target) target.classList.add("calendar-selected");

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        filterState.dateType = 'day';
        filterState.dateValue = day;
        applyFilters();
      }

      function sortNews(type) {
        filterState.sort = type;
        applyFilters();
      }

      // ë‹¤ì¤‘ URL íŒŒì‹± í•¨ìˆ˜
      function parseUrls(urlString) {
        if (!urlString) return [];

        // URLê³¼ ì¶œì²˜ëª… íŒ¨í„´ íŒŒì‹±: "ì¶œì²˜ëª…: URL" ë˜ëŠ” ë‹¨ìˆœ URL
        const urlPattern = /(?:([^:,]+):\s*)?(https?:\/\/[^\s,]+)/g;
        const urls = [];
        let match;

        while ((match = urlPattern.exec(urlString)) !== null) {
          urls.push({
            name: match[1] ? match[1].trim() : extractDomain(match[2]),
            url: match[2].trim(),
          });
        }

        return urls.length > 0 ? urls : [{ name: "ì›ë¬¸", url: urlString }];
      }

      // ë„ë©”ì¸ì—ì„œ ì¶œì²˜ëª… ì¶”ì¶œ
      function extractDomain(url) {
        try {
          const domain = new URL(url).hostname.replace("www.", "");
          return domain.split(".")[0];
        } catch {
          return "ì¶œì²˜";
        }
      }

      function renderFeed(data) {
        const feed = document.getElementById("news-feed");
        const t = translations[currentLang];
        
        feed.innerHTML = data
          .map((n) => {
            const urls = parseUrls(n.URL);
            const sourceLinksHtml = urls
              .map(
                (src) =>
                  `<a href="${src.url}" target="_blank" class="source-link" onclick="event.stopPropagation()">
                        <i data-lucide="external-link" class="w-3 h-3"></i>
                        ${src.name}
                    </a>`,
              )
              .join("");

            // ì˜í–¥ë„ í‘œì‹œ ìŠ¤íƒ€ì¼ ê²°ì •
            let impactHtml = "";
            if (n.Impact) {
              const isPositive = n.Impact.includes("+");
              const isNegative = n.Impact.includes("-");
              const colorClass = isPositive
                ? "text-green-600 bg-green-50"
                : isNegative
                  ? "text-red-600 bg-red-50"
                  : "text-slate-600 bg-slate-50";
              impactHtml = `<span class="px-2 py-0.5 rounded text-[9px] font-bold ${colorClass}">Impact: ${n.Impact}</span>`;
            }

            // ì–¸ì–´ì— ë”°ë¥¸ ì œëª©/ìš”ì•½/ë‚ ì§œ ì²˜ë¦¬
            let displayTitle = n.Title;
            let displaySummary = n.Summary;
            let displayCategory = n.Category || "N/A";
            
            if (currentLang === 'en') {
                if (n.Title_en) displayTitle = n.Title_en;
                if (n.Summary_en) displaySummary = n.Summary_en;
                if (n.Category_en) displayCategory = n.Category_en;
            }

            // 1. ë´‡ ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ ë° ì–¸ì–´ë³„ ë§¤í•‘
            let botContent = n.BOT || n.Bot || n.bot;
            if (currentLang === 'en') {
                botContent = n.BOT_en || n["BOT(eng)"] || botContent; 
            }
            // Escape quotes for attribute safety
            const safeBotContent = botContent ? botContent.toString().replace(/"/g, '&quot;') : '';

            return `
                <article id="${n._uId}" 
                    class="news-item bg-white dark:bg-[#25282c] p-6 rounded-xl shadow-sm border border-transparent hover:border-blue-100 transition-all ${botContent ? 'has-bot' : ''}" 
                    onclick="this.classList.toggle('expanded')">
                    <div class="news-inner">
                        <div class="flex gap-8 items-start">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-3">
                                    <span class="px-2 py-0.5 rounded text-[9px] font-bold ${n.Risk === "High" ? "bg-red-50 text-red-600" : "bg-blue-50 text-blue-600"}">${displayCategory}</span>
                                    ${n.Region || n.Country ? `<span class="px-2 py-0.5 rounded text-[9px] font-bold bg-indigo-50 text-indigo-600">${n.Region || n.Country}</span>` : ""}
                                    ${impactHtml}
                                    <span class="text-[10px] text-slate-400 ml-auto font-medium">${n.Date ? n.Date.toString().split("T")[0] : ""}</span>
                                </div>
                                
                                <h4 class="font-bold text-base mb-3 leading-snug">${displayTitle || "No Title"}</h4>
                                
                                <div class="news-body-grid">
                                    <div class="news-content-col">
                                        <p class="summary-text text-[13px] text-slate-500 dark:text-slate-400 leading-relaxed mb-4">${displaySummary || ""}</p>
                                        <div class="source-links">${sourceLinksHtml}</div>
                                    </div>
                                    
                                    ${botContent ? `
                                    <div class="news-bot-col" onclick="event.stopPropagation()">
                                        <div class="bot-inner-bubble">
                                            <div class="font-black mb-1 text-xs opacity-70">ğŸ’¡ AI Insight</div>
                                            ${botContent}
                                        </div>
                                    </div>
                                    ` : ""}
                                </div>
                            </div>
                            
                            ${n.Image ? `<div class="w-44 h-32 rounded-lg overflow-hidden flex-shrink-0 border dark:border-gray-800"><img src="${n.Image}" class="w-full h-full object-cover" onerror="this.style.display='none'; this.parentElement.style.display='none';"></div>` : ""}
                        </div>
                    </div>
                </article>`;
          })
          .join("");
        lucide.createIcons();
      }

      /* Global Bot Follower Logic */

      // 3D ì¸í„°ë™í‹°ë¸Œ íƒœê·¸ í´ë¼ìš°ë“œ - ìˆœìˆ˜ JavaScript êµ¬í˜„
      let tag3DRotation = { x: 0, y: 0 };
      let tag3DSpeed = { x: 0.5, y: 0.3 };
      let isDraggingTag = false;
      let tagDragStart = { x: 0, y: 0 };
      let tagAnimationId = null;

      function renderTags(data) {
        if (tagAnimationId) cancelAnimationFrame(tagAnimationId);
        
        console.log("renderTags called with", data.length, "items");
        const tagMap = {};

        const t = translations[currentLang];
        
        if (!data || data.length === 0) {
            const container = document.getElementById("tagCloud3D");
            if (container) container.innerHTML = `<div style="color: #94a3b8; font-size: 11px; text-align: center; padding: 80px;">${t.tag_data_error}</div>`;
            return;
        }

        data.forEach((n) => {
          // íƒœê·¸ í•„ë“œ í™•ì¸
          let tagField = n.Tag || n.tag || n.Tags || n.tags || n.KEYWORD || n.Keyword || n.keyword;
          if (currentLang === 'en' && n.Tag_en) tagField = n.Tag_en; // ì˜ë¬¸ íƒœê·¸ ìš°ì„ 

          if (tagField) {
            tagField.split(",").forEach((tag) => {
              const t = tag.trim();
              if (t && t.length > 0) tagMap[t] = (tagMap[t] || 0) + 1;
            });
          }
        });
        
        const sortedTags = Object.entries(tagMap)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 15);

        if (sortedTags.length === 0) {
          const container = document.getElementById("tagCloud3D");
          if (container) container.innerHTML = `<div style="color: #94a3b8; font-size: 11px; text-align: center; padding: 80px;">${t.tag_data_error}</div>`;
          return;
        }

        const maxCount = Math.max(...sortedTags.map(([_, c]) => c), 1);
        const container = document.getElementById("tagCloud3D");
        container.innerHTML = "";

        // 3D êµ¬ ì¢Œí‘œ ìƒì„± (í”¼ë³´ë‚˜ì¹˜ êµ¬ë©´ ë¶„í¬ ì•Œê³ ë¦¬ì¦˜)
        const tags3D = sortedTags.map(([tag, count], i) => {
          const k = i + 1;
          const phi = Math.acos(1 - (2 * k) / (sortedTags.length + 1));
          const theta = Math.PI * (1 + Math.sqrt(5)) * k;
          const radius = 80; // 200px ì»¨í…Œì´ë„ˆì— ì í•©í•œ ë°˜ì§€ë¦„

          return {
            tag,
            count,
            x: radius * Math.cos(theta) * Math.sin(phi),
            y: radius * Math.sin(theta) * Math.sin(phi),
            z: radius * Math.cos(phi),
          };
        });

        // íƒœê·¸ ìš”ì†Œ ìƒì„±
        tags3D.forEach((tagObj) => {
          const elem = document.createElement("div");
          elem.className = "tag3d";
          elem.textContent = tagObj.tag;
          elem.style.fontSize = `${10 + (tagObj.count / maxCount) * 8}px`; // í°íŠ¸ í¬ê¸° ê°€ë…ì„± ê°œì„ 
          elem.dataset.x = tagObj.x;
          elem.dataset.y = tagObj.y;
          elem.dataset.z = tagObj.z;
          elem.onclick = (e) => {
            e.stopPropagation();
            showTagReport(tagObj.tag);
          };
          container.appendChild(elem);
        });

        // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„ ì‹œì‘
        animateTagCloud();

        // ë“œë˜ê·¸ ë° ë§ˆìš°ìŠ¤ ì¡°ì‘ ì´ë²¤íŠ¸ (ì „ì—­ ë“±ë¡)
        if (!window.isTagEventRegistered) {
          const cloudBox = document.getElementById("tagCloudContainer");
          
          cloudBox.addEventListener("mousedown", (e) => {
            isDraggingTag = true;
            tagDragStart = { x: e.clientX, y: e.clientY };
          });
          
          window.addEventListener("mousemove", (e) => {
            if (isDraggingTag) {
              const dx = e.clientX - tagDragStart.x;
              const dy = e.clientY - tagDragStart.y;
              // íšŒì „ ê°ë„ ì¡°ì ˆ
              tag3DRotation.y += dx * 0.005;
              tag3DRotation.x -= dy * 0.005;
              tagDragStart = { x: e.clientX, y: e.clientY };
            }
          });
          
          window.addEventListener("mouseup", () => {
            isDraggingTag = false;
          });
          
          window.isTagEventRegistered = true;
        }
      }

      function animateTagCloud() {
        if (!isDraggingTag) {
          // ìì—°ìŠ¤ëŸ¬ìš´ ìë™ íšŒì „
          tag3DRotation.x += 0.002;
          tag3DRotation.y += 0.003;
        }

        const tags = document.querySelectorAll(".tag3d");
        const radius = 80;

        tags.forEach((tag) => {
          const x0 = parseFloat(tag.dataset.x);
          const y0 = parseFloat(tag.dataset.y);
          const z0 = parseFloat(tag.dataset.z);

          // 3D íšŒì „ í–‰ë ¬ ê³„ì‚° (X, Yì¶• ê¸°ì¤€)
          const cosX = Math.cos(tag3DRotation.x);
          const sinX = Math.sin(tag3DRotation.x);
          let y1 = y0 * cosX - z0 * sinX;
          let z1 = y0 * sinX + z0 * cosX;

          const cosY = Math.cos(tag3DRotation.y);
          const sinY = Math.sin(tag3DRotation.y);
          let x2 = x0 * cosY + z1 * sinY;
          let z2 = -x0 * sinY + z1 * cosY;

          // íˆ¬ì˜ ë° ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸ (Zì¶• ê¹Šì´ì— ë”°ë¥¸ íš¨ê³¼)
          const depth = (z2 + radius) / (2 * radius); // 0 (ë’¤) ~ 1 (ì•)
          const scale = 0.5 + depth * 0.8; // 0.5x ~ 1.3x
          const opacity = 0.2 + depth * 0.8; // 0.2 ~ 1.0

          // translate3dë¥¼ ì‚¬ìš©í•˜ì—¬ GPU ê°€ì† í™œìš©
          tag.style.transform = `translate3d(${x2}px, ${y1}px, ${z2}px) scale(${scale})`;
          tag.style.opacity = opacity;
          tag.style.zIndex = Math.round(depth * 100);
          
          // íë¦¼ íš¨ê³¼ (ì„ íƒì : ê¹Šì´ í‘œí˜„ ê°•ì¡°)
          if (depth < 0.3) {
            tag.style.filter = `blur(0.5px)`;
          } else {
            tag.style.filter = 'none';
          }
        });

        tagAnimationId = requestAnimationFrame(animateTagCloud);
      }

      // ê¸€ë¡œë²Œ ì§€ë„ ë Œë”ë§
      function renderWorldMap(data) {
        console.log("renderWorldMap called with", data.length, "items");
        const t = translations[currentLang];
        
        if (!data || data.length === 0) {
             document.getElementById("worldMap").innerHTML =
            `<div style="color: #94a3b8; font-size: 11px; text-align: center; padding: 40px;">${t.region_data_error}</div>`;
            return;
        }
        
        const countryMap = {};
        data.forEach((n) => {
          // ë‹¤ì–‘í•œ ëŒ€ì†Œë¬¸ì/í•„ë“œëª… ì§€ì›
          let regionField = n.Region || n.region || n.Country || n.country || n.Place || n.place || n.Location || n.location;
          if (currentLang === 'en' && n.Region_en) regionField = n.Region_en;

          if (regionField) {
            const countries = regionField.split(",").map((c) => c.trim());
            countries.forEach((country) => {
              if (country) countryMap[country] = (countryMap[country] || 0) + 1;
            });
          }
        });
        
        const mapContainer = document.getElementById("worldMap");

        if (Object.keys(countryMap).length === 0) {
          mapContainer.innerHTML =
            `<div style="color: #94a3b8; font-size: 11px; text-align: center; padding: 40px;">${t.region_data_error}</div>`;
          console.log("No countries found");
          return;
        }

        mapContainer.innerHTML = "";

        // ì‹¤ì œ ì„¸ê³„ ì§€ë„ ì´ë¯¸ì§€ ë°°ê²½
        mapContainer.style.backgroundImage = "url(world_map_real.png)";
        mapContainer.style.backgroundSize = "100% 100%";
        mapContainer.style.backgroundPosition = "center";
        mapContainer.style.backgroundRepeat = "no-repeat";

        // êµ­ê°€ë³„ ê¸°ì‚¬ ìˆ˜ í‘œì‹œ
        console.log("Adding country list");
        const countryList = document.createElement("div");
        countryList.style.cssText =
          "position: absolute; top: 5px; left: 5px; background: rgba(255,255,255,0.95); padding: 8px; border-radius: 6px; font-size: 9px; max-height: 180px; overflow-y: auto; z-index: 10;";
        
        // êµ­ê°€ë³„ ë¦¬ìŠ¤íŠ¸ ì œëª© ë²ˆì—­ì€ ìƒëµí•˜ê±°ë‚˜ ì¶”ê°€ í•„ìš” (ì—¬ê¸°ì„œëŠ” í•˜ë“œì½”ë”©ëœ ë¶€ë¶„ì´ë¼ ìˆ˜ì •)
        // 'êµ­ê°€ë³„ ê¸°ì‚¬' -> t.region_data_error ê°™ì€ê±¸ ì“¸ìˆœ ì—†ê³ ... 'By Country' ì •ë„?
        // ì¼ë‹¨ ìœ ì§€í•˜ë˜ 'Country'ë¡œ ë³€ê²½ ê³ ë ¤.
        const listTitle = currentLang === 'en' ? "By Country" : "êµ­ê°€ë³„ ê¸°ì‚¬";
        
        countryList.innerHTML =
          `<div style="font-weight: 700; margin-bottom: 4px; color: #1428a0;">${listTitle}</div>` +
          Object.entries(countryMap)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 10)
            .map(
              ([country, count]) =>
                `<div style="cursor: pointer; padding: 2px 0; color: #64748b;" onclick="filterByCountry('${country}')" onmouseover="this.style.color='#1428a0'" onmouseout="this.style.color='#64748b'">
                            ${country}: ${count}
                        </div>`,
            )
            .join("");
        mapContainer.appendChild(countryList);

        // êµ­ê°€ ë§ˆì»¤ ì¶”ê°€
        console.log("Adding country markers");
        let markerCount = 0;
        Object.entries(countryMap).forEach(([country, count]) => {
          const coords = countryCoords[country];
          console.log(`Checking country: ${country}, coords:`, coords);
          if (coords) {
            const marker = document.createElement("div");
            marker.className = "country-marker";
            marker.setAttribute("data-country", `${country} (${count})`);
            marker.style.left = `${coords.x}%`;
            marker.style.top = `${coords.y}%`;

            // ë¹ˆë„ì— ë”°ë¥¸ í¬ê¸° ì¡°ì •
            const maxCount = Math.max(...Object.values(countryMap));
            const size = 10 + (count / maxCount) * 10;
            marker.style.width = `${size}px`;
            marker.style.height = `${size}px`;

            // í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
            if (count > 1) {
              marker.style.animation = "pulse 2s infinite";
            }

            marker.addEventListener("click", () => filterByCountry(country));
            mapContainer.appendChild(marker);
            markerCount++;
          } else {
            console.log(`No coords for country: ${country}`);
          }
        });

        console.log("Total markers added:", markerCount);
      }

      function filterByCountry(country) {
        if (filterState.country === country) {
            filterState.country = "all"; // Toggle off
        } else {
            filterState.country = country;
        }
        applyFilters();
      }

      function showTagReport(tag) {
        if (filterState.tag === tag) {
            filterState.tag = "all"; // Toggle off
        } else {
            filterState.tag = tag;
        }
        applyFilters();
      }

      function closeModal() {
        document.getElementById("reportModal").classList.add("hidden");
      }

      function showIndexModal() {
        document.getElementById("indexModal").classList.remove("hidden");
      }

      function closeIndexModal(event) {
        if (!event || event.target.id === "indexModal" || event.target.closest('button')) {
             document.getElementById("indexModal").classList.add("hidden");
        }
      }

      function goToday() {
        const today = new Date();
        curYear = today.getFullYear();
        curMonth = today.getMonth();
        
        document.getElementById("calHeader").innerText =
          `${curYear}. ${String(curMonth + 1).padStart(2, "0")}`;
          
        renderCalendar(allNews);
        filterByDate(today.getDate());
      }

      function filterNews(cat) {
        filterState.category = cat;
        // ì¹´í…Œê³ ë¦¬ ì„ íƒ ì‹œ ë‹¬ë ¥ ìƒíƒœëŠ” ìœ ì§€ (ì¤‘ì²© í•„í„°)
        applyFilters();
      }

      function filterByRisk(risk) {
        filterState.risk = risk;
        applyFilters();
      }

      function handleSearch(event) {
        filterState.search = event.target.value.toLowerCase();
        applyFilters();
      }

      function handleSearchScope(event) {
        filterState.scope = event.target.value;
        applyFilters();
      }

      function resetFilters() {
        document.getElementById("searchInput").value = "";
        
        // ìƒíƒœ ì´ˆê¸°í™”
        filterState = {
            category: "all",
            risk: "all",
            sort: "latest",
            search: "",
            scope: "all",
            dateType: null,
            dateValue: null,
            country: "all",
            tag: "all"
        };
        
        document.getElementById("searchScope").value = "all";

        // ë‹¬ë ¥ UI ì´ˆê¸°í™”
        document.querySelectorAll(".calendar-grid span").forEach((el) => {
          el.classList.remove("calendar-selected", "week-selected");
        });

        // ë‹¬ë ¥ í—¤ë” ë¦¬ì…‹ (í˜„ì¬ ì—°ì›”ë¡œ)
        const now = new Date();
        curYear = now.getFullYear();
        curMonth = now.getMonth();
        const header = document.getElementById("calHeader");
        if (header) header.innerText = `${curYear}. ${String(curMonth + 1).padStart(2, "0")}`;
        renderCalendar(allNews);

        applyFilters();
      }

      // [í•µì‹¬] í†µí•© í•„í„°ë§ ë¡œì§
      function applyFilters() {
        const t = translations[currentLang];
        let result = [...allNews];

        // 0. ë‚´ë¹„ê²Œì´ì…˜ UI í•˜ì´ë¼ì´íŠ¸ ì—…ë°ì´íŠ¸
        document.querySelectorAll('nav a').forEach(a => {
            a.classList.remove('text-[#1428a0]', 'border-b-2', 'border-[#1428a0]', 'pb-0.5');
            a.classList.add('text-slate-400');
            
            if (filterState.category === 'all' && a.id === 'nav-all') {
                a.classList.add('text-[#1428a0]', 'border-b-2', 'border-[#1428a0]', 'pb-0.5');
                a.classList.remove('text-slate-400');
            } else if (a.innerText === filterState.category || 
                     (filterState.category === 'ì‹ ê¸°ìˆ ë™í–¥' && (a.innerText === 'ì‹ ê¸°ìˆ ë™í–¥' || a.innerText === t.nav_tech))) {
                a.classList.add('text-[#1428a0]', 'border-b-2', 'border-[#1428a0]', 'pb-0.5');
                a.classList.remove('text-slate-400');
            }
        });

        const breadcrumbs = [];

        // 1. ì¹´í…Œê³ ë¦¬ í•„í„°
        if (filterState.category !== "all") {
             result = result.filter(n => {
                const cat = n.Category ? n.Category.split(":")[0].trim() : "";
                if (filterState.category === "ì‹ ê¸°ìˆ ë™í–¥") {
                    return cat === "AIê¸°ìˆ " || cat === "ì‹ ê¸°ìˆ ";
                }
                return cat === filterState.category;
             });
             
             let catName = filterState.category;
             if (catName === "ì‹ ê¸°ìˆ ë™í–¥" && currentLang === 'en') catName = t.nav_tech;
             breadcrumbs.push(`[${catName}]`);
        } else {
             breadcrumbs.push(`[${currentLang === 'en' ? 'Strategy' : 'ì „ëµ ì‹œí™©'}]`);
        }

        // 2. ë‚ ì§œ í•„í„° (Calendar)
        if (filterState.dateType === 'week') {
            const range = getDateRangeForWeek(curYear, curMonth, filterState.dateValue);
            result = result.filter(n => {
                 const d = parseDate(n.Date);
                 return d.getFullYear() === curYear && d.getMonth() === curMonth && d.getDate() >= range.start && d.getDate() <= range.end;
            });
            breadcrumbs.push(`Week ${filterState.dateValue} (${curYear}.${String(curMonth + 1).padStart(2, "0")})`);
        } else if (filterState.dateType === 'day') {
            result = result.filter(n => {
                const d = parseDate(n.Date);
                return d.getFullYear() === curYear && d.getMonth() === curMonth && d.getDate() === filterState.dateValue;
            });
            breadcrumbs.push(`${curYear}.${String(curMonth + 1).padStart(2, "0")}.${String(filterState.dateValue).padStart(2, "0")}`);
        }

        // 3. ë¦¬ìŠ¤í¬ í•„í„°
        document.querySelectorAll(".risk-filter-btn").forEach((btn) => {
          btn.classList.remove("active");
          if (btn.innerText === filterState.risk.toUpperCase()) btn.classList.add("active");
        });

        if (filterState.risk !== "all") {
            result = result.filter(n => n.Risk === filterState.risk);
            breadcrumbs.push(`(${filterState.risk} Risk)`);
        }

        // 4. êµ­ê°€/ì§€ì—­ í•„í„°
        if (filterState.country !== "all") {
            result = result.filter(n => {
                const region = n.Region || n.Country;
                return region && region.includes(filterState.country);
            });
            breadcrumbs.push(`[${filterState.country}]`);
        }

        // 5. íƒœê·¸ í•„í„°
        if (filterState.tag !== "all") {
            result = result.filter(n => {
                const tags = n.Tag || n.Tags;
                return tags && tags.includes(filterState.tag);
            });
            breadcrumbs.push(`#${filterState.tag}`);
        }

        // 6. ê²€ìƒ‰ í•„í„°
        if (filterState.search) {
            const q = filterState.search;
            const scope = filterState.scope || "all";
            
            result = result.filter(n => {
                const titleMatch = (n.Title && n.Title.toLowerCase().includes(q)) || (n.Title_en && n.Title_en.toLowerCase().includes(q));
                const summaryMatch = (n.Summary && n.Summary.toLowerCase().includes(q)) || (n.Summary_en && n.Summary_en.toLowerCase().includes(q));
                const tagMatch = n.Tag && n.Tag.toLowerCase().includes(q);
                const regionMatch = n.Region && n.Region.toLowerCase().includes(q);

                if (scope === "title") return titleMatch;
                if (scope === "content") return summaryMatch;
                return titleMatch || summaryMatch || tagMatch || regionMatch;
            });

            const scopeMap = { 
                "title": t.search_scope_title, 
                "content": t.search_scope_content, 
                "all": currentLang === 'en' ? "All" : "ì „ì²´" 
            };
            const searchLabel = currentLang === 'en' ? `Search: '${q}'` : `'${q}' ê²€ìƒ‰ (${scopeMap[scope]})`;
            breadcrumbs.push(searchLabel);
        }

        // ë¸Œë ˆë“œí¬ëŸ¼ íƒ€ì´í‹€ ìƒì„±
        let title = breadcrumbs.join(" ");
        if (breadcrumbs.length === 0 || (breadcrumbs.length === 1 && breadcrumbs[0].includes(currentLang === 'en' ? 'Strategy' : 'ì „ëµ ì‹œí™©'))) {
            title = t.feed_title;
        }
        document.getElementById("feedTitle").innerText = title;

        // 5. ì •ë ¬ (Latest / Oldest)
        const lb = document.getElementById("sortLatest");
        const rb = document.getElementById("sortOldest");
        if (lb && rb) {
            lb.classList.remove("text-[#1428a0]", "text-slate-400");
            rb.classList.remove("text-[#1428a0]", "text-slate-400");
            
            if (filterState.sort === "latest") {
                lb.classList.add("text-[#1428a0]");
                rb.classList.add("text-slate-400");
                result.sort((a, b) => parseDate(b.Date) - parseDate(a.Date));
            } else {
                rb.classList.add("text-[#1428a0]");
                lb.classList.add("text-slate-400");
                result.sort((a, b) => parseDate(a.Date) - parseDate(b.Date));
            }
        }

        currentFilteredNews = result;
        renderFeed(result);
        renderSummary(result);
        renderWorldMap(result);
        renderTags(result);
      }

      function renderSummary(data) {
        // ë¦¬ìŠ¤í¬ ê°€ì¤‘ì¹˜ ë§µ
        const riskMap = { High: 3, Med: 2, Low: 1 };
        
        // í˜„ì¬ í•„í„°ë§ëœ ë°ì´í„° ì¤‘ì—ì„œ ë¦¬ìŠ¤í¬ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ìƒìœ„ 3ê°œ ì¶”ì¶œ
        const topRisks = [...data]
            .sort((a, b) => (riskMap[b.Risk] || 0) - (riskMap[a.Risk] || 0))
            .slice(0, 3);

        document.getElementById("summaryGrid").innerHTML = topRisks
          .map(
            (a) => {
                let displayTitle = a.Title;
                if(currentLang === 'en' && a.Title_en) displayTitle = a.Title_en;

                return `<div class="p-6 bg-white dark:bg-[#25282c] shadow-sm border-t-4 border-[#1428a0] rounded-lg cursor-pointer transform hover:scale-[1.02] transition-all" 
                    onclick="focusNews('${a._uId}')">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-[9px] font-bold px-1.5 py-0.5 rounded ${a.Risk === 'High' ? 'bg-red-100 text-red-600' : 'bg-blue-100 text-blue-600'}">${a.Risk || 'Info'}</span>
                        <span class="text-[9px] text-gray-400">${a.Date ? a.Date.toString().split("T")[0] : ""}</span>
                    </div>
                    <h4 class="font-bold text-sm line-clamp-2 hover:text-[#1428a0]">${displayTitle || "No Title"}</h4>
                </div>`;
            }
          )
          .join("");
      }

      function focusNews(id) {
        const el = document.getElementById(id);
        if (el) {
            // ë¶€ë“œëŸ½ê²Œ ìŠ¤í¬ë¡¤ ì´ë™
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            // ì¹´ë“œ ê°•ì¡° íš¨ê³¼ (ë°˜ì§ì„)
            el.classList.add('ring-2', 'ring-[#1428a0]', 'ring-offset-2');
            setTimeout(() => el.classList.remove('ring-2', 'ring-[#1428a0]', 'ring-offset-2'), 2000);
            
            // ë‚´ìš© í¼ì¹˜ê¸°
            if (!el.classList.contains('expanded')) {
                el.classList.add('expanded');
            }
        }
      }

      function toggleDarkMode() {
        document.documentElement.classList.toggle("dark");
        lucide.createIcons();
      }




      window.onload = () => {
        lucide.createIcons();
        
        // ì´ˆê¸° ìº˜ë¦°ë” í—¤ë” ì„¤ì • (JS ë¡œë“œ ì‹œì ì— ì¦‰ì‹œ ë°˜ì˜)
        document.getElementById("calHeader").innerText = `${curYear}. ${String(curMonth + 1).padStart(2, "0")}`;
        
        fetchNews();
        // renderFXRates();
        // renderMaterialPrices();

        // 1ë¶„ë§ˆë‹¤ í™˜ìœ¨/ì›ìì¬ ë°ì´í„° ì—…ë°ì´íŠ¸
        // setInterval(() => {
        //   renderFXRates();
        //   renderMaterialPrices();
        // }, 60000);
      };
    </script>


    <div
      id="indexModal"
      class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-[1000]"
      onclick="closeIndexModal(event)"
    >
      <div class="bg-white dark:bg-[#25282c] p-6 rounded-2xl shadow-2xl relative" onclick="event.stopPropagation()">
          <button
            onclick="closeIndexModal()"
            class="absolute top-4 right-4 hover:bg-gray-100 dark:hover:bg-gray-700 p-2 rounded-full transition-colors"
          >
            <i data-lucide="x" class="w-6 h-6 text-gray-500"></i>
          </button>
          
          <!-- Load the TradingView Widget.html inside an iframe -->
          <div class="w-full flex justify-center items-center">
             <iframe src="TradingView Widget.html" style="width: 580px; height: 430px; border: none; overflow: hidden;" scrolling="no"></iframe>
          </div>
      </div>
    </div>
  </body>
</html>
