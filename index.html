<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEC DA Purchase Intelligence Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <script>tailwind.config = { darkMode: 'class' }</script>
    <style>
        body { font-family: 'Pretendard', sans-serif; transition: all 0.3s ease; }
        .header { height: 55px; position: fixed; top: 0; width: 100%; z-index: 100; border-bottom: 2px solid #1428a0; }
        .sidebar { width: 280px; position: fixed; left: 0; top: 55px; height: calc(100vh - 55px); border-right: 1px solid #eee; padding: 25px; overflow-y: auto; background: white; }
        .main-content { margin-left: 280px; margin-top: 55px; padding: 30px 40px; max-width: 1200px; }

        /* 1. 안정적인 8열 그리드 달력 (주차 포함) */
        .calendar-grid { 
            display: grid; 
            grid-template-columns: 28px repeat(7, minmax(28px, 1fr)); 
            gap: 4px; 
            align-items: center; 
            justify-items: center;
            width: 100%;
            max-width: 280px;
        }
        .calendar-grid span { 
            width: 28px; 
            height: 28px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            border-radius: 50%; 
            transition: all 0.3s ease; 
            font-size: 10px; 
            cursor: default; 
            position: relative;
            flex-shrink: 0;
        }
        
        /* 주차 표시 스타일 */
        .week-label {
            font-size: 9px !important;
            font-weight: 700;
            color: #94a3b8;
            cursor: pointer !important;
            transition: all 0.2s;
        }
        .week-label:hover {
            color: #1428a0;
            transform: scale(1.1);
        }
        .week-selected {
            background: #1428a0 !important;
            color: white !important;
            border-radius: 4px !important;
        }
        
        /* 리스크 필터 버튼 스타일 */
        .risk-filter-btn.active { background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .dark .risk-filter-btn.active { background: #3f444a; }
        
        /* 얄쌍한 링 디자인 (LV1~LV3) */
        .calendar-ring { border: 1.2px solid #1428a0; color: #1428a0; font-weight: 800; cursor: pointer !important; }
        .ring-lv1 { width: 20px !important; height: 20px !important; border-width: 1px; }
        .ring-lv2 { width: 24px !important; height: 24px !important; border-width: 2px; }
        .ring-lv3 { width: 28px !important; height: 28px !important; border-width: 3px; box-shadow: 0 0 8px rgba(20,40,160,0.15); }
        .calendar-selected { background-color: #1428a0 !important; color: white !important; border: none !important; }

        /* 네비게이션 화살표 스타일 */
        .nav-btn { cursor: pointer; padding: 2px; border-radius: 4px; transition: all 0.2s; color: #cbd5e1; }
        .nav-btn:hover { background: #f1f5f9; color: #1428a0; }

        /* 2. 동적 확장 카드 및 이미지 효과 */
        .news-item { border-bottom: 1px solid #f1f5f9; padding: 24px 0; cursor: pointer; transition: all 0.4s ease; overflow: hidden; max-height: 240px; }
        .news-item.expanded { max-height: 1500px; background: #fcfdfe; border-bottom: 2px solid #1428a0; }
        .summary-text { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .news-item.expanded .summary-text { -webkit-line-clamp: unset; }
        .news-item img { filter: grayscale(100%); transition: all 0.5s ease; }
        .news-item:hover img { filter: grayscale(0%); transform: scale(1.05); }

        /* 3D 인터랙티브 태그 클라우드 - 순수 JS 구현 */
        #tagCloudContainer {
            position: relative;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-radius: 8px;
            overflow: hidden;
            perspective: 600px;
        }
        #tagCloud3D {
            width: 100%;
            height: 200px;
            position: relative;
            transform-style: preserve-3d;
        }
        .tag3d {
            position: absolute;
            left: 50%;
            top: 50%;
            font-size: 12px;
            font-weight: 600;
            color: #e2e8f0;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            user-select: none;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .tag3d:hover {
            color: #60a5fa;
            transform: scale(1.2) !important;
            text-shadow: 0 0 10px rgba(96, 165, 250, 0.6);
        }

        /* 글로벌 지도 스타일 */
        #worldMap {
            width: 100%;
            height: 130px;
            background: #f8fafc;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }
        .country-marker {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #1428a0;
            border: 2px solid white;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .country-marker:hover {
            transform: scale(1.5);
            z-index: 10;
        }
        .country-marker::after {
            content: attr(data-country);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1428a0;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 9px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            margin-bottom: 4px;
        }
        .country-marker:hover::after {
            opacity: 1;
        }
        
        /* 펄스 애니메이션 */
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.3);
                opacity: 0.7;
            }
        }

        /* 환율/원자재 슬라이드 스타일 */
        .market-section {
            margin-bottom: 20px;
            background: #f8fafc;
            border-radius: 8px;
            padding: 12px;
            position: relative;
            overflow: hidden;
            height: 80px;
        }
        .market-carousel {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        .market-slide {
            min-width: 100%;
            flex-shrink: 0;
            box-sizing: border-box;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }
        .market-label {
            font-weight: 600;
            color: #64748b;
            font-size: 10px;
        }
        .market-value {
            font-weight: 700;
            color: #1428a0;
            font-size: 12px;
        }
        .market-change {
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-top: 4px;
            display: inline-block;
        }
        .market-up {
            color: #dc2626;
            background: #fee2e2;
        }
        .market-down {
            color: #2563eb;
            background: #dbeafe;
        }
        .carousel-dots {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin-top: 8px;
        }
        .carousel-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #cbd5e1;
            cursor: pointer;
            transition: all 0.3s;
        }
        .carousel-dot.active {
            background: #1428a0;
            width: 12px;
            border-radius: 3px;
        }

        /* URL 출처 링크 스타일 */
        .source-links {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        .source-link {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: #f1f5f9;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            color: #1428a0;
            text-decoration: none;
            transition: all 0.2s;
        }
        .source-link:hover {
            background: #1428a0;
            color: white;
            transform: translateY(-1px);
        }

        .dark body { background-color: #1a1c1e; color: #e2e8f0; }
        .dark .header, .dark .sidebar, .dark .news-item { background-color: #25282c; border-color: #3f444a; }
    </style>
</head>
<body class="bg-[#fcfcfc] text-[#333]">

    <header class="header flex items-center px-6 justify-between bg-white dark:bg-[#25282c] shadow-sm">
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-2 cursor-pointer" onclick="location.reload()">
                <div class="w-7 h-7 bg-[#1428a0] rounded flex items-center justify-center text-white font-bold text-xs shadow-sm">DA</div>
                <h1 class="text-base font-black text-[#1428a0] dark:text-blue-400 tracking-tighter uppercase">Purchase Intelligence</h1>
            </div>
            <nav class="flex gap-8 text-sm font-bold text-gray-400">
                <a href="#" class="text-[#1428a0] border-b-2 border-[#1428a0] pb-1" onclick="resetFilters()">전략 시황</a>
                <a href="#" onclick="filterNews('원자재')">원자재</a>
                <a href="#" onclick="filterNews('거시경제')">거시/정책</a>
                <a href="#" onclick="filterNews('생산지역')">생산지역</a>
                <a href="#" onclick="filterNews('경쟁사')">경쟁사</a>
            </nav>
        </div>
        <div class="flex items-center gap-4 flex-1 max-w-md mx-8">
            <div class="relative w-full">
                <i data-lucide="search" class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                <input type="text" id="searchInput" onkeyup="handleSearch(event)" placeholder="뉴스 키워드 검색..." 
                    class="w-full bg-gray-50 dark:bg-gray-800 border-none rounded-full py-1.5 pl-10 pr-4 text-sm focus:ring-2 focus:ring-[#1428a0] transition-all outline-none">
            </div>
        </div>
        <button onclick="toggleDarkMode()" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
            <i data-lucide="moon" id="themeIcon" class="w-4 h-4 text-gray-500"></i>
        </button>
    </header>

    <aside class="sidebar dark:bg-[#25282c]">
        <!-- 달력 섹션 -->
        <div class="mb-8">
            <h3 class="text-[10px] font-black mb-4 dark:text-gray-200 uppercase tracking-widest text-slate-400 flex justify-between items-center">
                Archive Calendar
                <div class="flex items-center gap-1 bg-gray-50 dark:bg-gray-800 px-2 py-1 rounded-md">
                    <i data-lucide="chevrons-left" class="w-3 h-3 nav-btn" onclick="moveCalendar(-1, 0)"></i>
                    <i data-lucide="chevron-left" class="w-3 h-3 nav-btn" onclick="moveCalendar(0, -1)"></i>
                    <span id="calHeader" class="text-[10px] font-bold text-[#1428a0] min-w-[55px] text-center">2026. 01</span>
                    <i data-lucide="chevron-right" class="w-3 h-3 nav-btn" onclick="moveCalendar(0, 1)"></i>
                    <i data-lucide="chevrons-right" class="w-3 h-3 nav-btn" onclick="moveCalendar(1, 0)"></i>
                </div>
            </h3>
            <div id="calendarGrid" class="calendar-grid text-slate-400"></div>
        </div>

        <!-- 글로벌 지도 섹션 -->
        <div class="mb-8">
            <h3 class="text-[10px] font-black mb-4 dark:text-gray-200 uppercase tracking-widest text-slate-400">Global Map</h3>
            <div id="worldMap"></div>
        </div>

        <!-- 환율 섹션 -->
        <div class="mb-8">
            <h3 class="text-[10px] font-black mb-4 dark:text-gray-200 uppercase tracking-widest text-slate-400">환율 (FX Rates)</h3>
            <div class="market-section">
                <div id="fxCarousel" class="market-carousel"></div>
                <div id="fxDots" class="carousel-dots"></div>
            </div>
        </div>

        <!-- 원자재 섹션 -->
        <div class="mb-8">
            <h3 class="text-[10px] font-black mb-4 dark:text-gray-200 uppercase tracking-widest text-slate-400">주요 원자재 (Materials)</h3>
            <div class="market-section">
                <div id="materialCarousel" class="market-carousel"></div>
                <div id="materialDots" class="carousel-dots"></div>
            </div>
        </div>

        <!-- 3D 태그 클라우드 섹션 -->
        <div>
            <h3 class="text-[10px] font-black mb-4 dark:text-gray-200 uppercase tracking-widest text-slate-400">Intelligence Cloud</h3>
            <div id="tagCloudContainer" style="width: 100%; height: 200px;">
                <div id="tagCloud3D"></div>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <div class="grid grid-cols-3 gap-6 mb-10" id="summaryGrid"></div>
        <div class="flex justify-between items-center mb-6 pb-2 border-b dark:border-gray-700">
            <h2 class="font-bold text-lg" id="feedTitle">Strategic Feed</h2>
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2 bg-slate-50 dark:bg-slate-800/50 p-1 rounded-lg">
                    <span class="text-[9px] px-2 text-slate-400">RISK:</span>
                    <button onclick="filterByRisk('all')" class="risk-filter-btn active px-2 py-0.5 rounded text-[9px] font-bold hover:bg-white dark:hover:bg-slate-700 transition-all">ALL</button>
                    <button onclick="filterByRisk('High')" class="risk-filter-btn px-2 py-0.5 rounded text-[9px] font-bold text-red-500 hover:bg-white dark:hover:bg-slate-700 transition-all">HIGH</button>
                    <button onclick="filterByRisk('Med')" class="risk-filter-btn px-2 py-0.5 rounded text-[9px] font-bold text-orange-500 hover:bg-white dark:hover:bg-slate-700 transition-all">MED</button>
                    <button onclick="filterByRisk('Low')" class="risk-filter-btn px-2 py-0.5 rounded text-[9px] font-bold text-blue-500 hover:bg-white dark:hover:bg-slate-700 transition-all">LOW</button>
                </div>
                <div class="text-[10px] flex gap-4 uppercase font-bold text-slate-400 border-l pl-4 dark:border-gray-700">
                    <span id="sortLatest" class="cursor-pointer text-[#1428a0]" onclick="sortNews('latest')">Latest</span>
                    <span id="sortRisk" class="cursor-pointer hover:text-[#1428a0]" onclick="sortNews('risk')">Risk</span>
                </div>
            </div>
        </div>
        <div id="loading" class="py-20 text-center animate-pulse text-blue-600 font-bold text-[10px] tracking-widest">SYNCING DATA...</div>
        <div id="news-feed" class="space-y-4"></div>
    </main>

    <div id="reportModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-[1000]">
        <div class="modal-content bg-white dark:bg-[#25282c] w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden transition-all duration-300 transform translate-y-4">
            <div class="p-6 border-b dark:border-gray-700 flex justify-between items-center bg-[#1428a0] text-white">
                <h3 class="font-bold text-lg flex items-center gap-2"><i data-lucide="file-text" class="w-5 h-5"></i> 전략 요약 보고서</h3>
                <button onclick="closeModal()" class="hover:bg-white/20 p-1 rounded-full"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <div id="modalBody" class="p-8 max-h-[70vh] overflow-y-auto space-y-6"></div>
        </div>
    </div>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbwpTIuLZcwhQa0eGpeXhX9xGTyp7Q3h84rxufHOGdyIUZUiA3SD7bunjDpmvK6-6OcDxQ/exec";
        let allNews = [], currentFilteredNews = [];
        let curYear = 2026, curMonth = 0;
        let tagCloudInstance = null;

        // 국가 좌표 맵핑 (실제 세계 지도 이미지 기준, %)
        // 표준 메르카토르 투영법 - 정확한 실제 위치
        const countryCoords = {
            // 북미
            '미국': { x: 22, y: 38 }, 'USA': { x: 22, y: 38 },
            '캐나다': { x: 20, y: 25 }, 'Canada': { x: 20, y: 25 },
            '멕시코': { x: 18, y: 48 }, 'Mexico': { x: 18, y: 48 },
            
            // 남미
            '브라질': { x: 32, y: 68 }, 'Brazil': { x: 32, y: 68 },
            
            // 유럽
            '영국': { x: 48, y: 30 }, 'UK': { x: 48, y: 30 }, 'United Kingdom': { x: 48, y: 30 },
            '프랑스': { x: 50, y: 34 }, 'France': { x: 50, y: 34 },
            '독일': { x: 52, y: 32 }, 'Germany': { x: 52, y: 32 },
            '이탈리아': { x: 53, y: 36 }, 'Italy': { x: 53, y: 36 },
            '스페인': { x: 47, y: 37 }, 'Spain': { x: 47, y: 37 },
            '러시아': { x: 70, y: 25 }, 'Russia': { x: 70, y: 25 },
            
            // 아시아
            '중국': { x: 76, y: 40 }, 'China': { x: 76, y: 40 },
            '일본': { x: 86, y: 38 }, 'Japan': { x: 86, y: 38 },
            '한국': { x: 82, y: 38 }, 'Korea': { x: 82, y: 38 }, 'South Korea': { x: 82, y: 38 },
            '인도': { x: 67, y: 45 }, 'India': { x: 67, y: 45 },
            '베트남': { x: 78, y: 50 }, 'Vietnam': { x: 78, y: 50 },
            '태국': { x: 76, y: 50 }, 'Thailand': { x: 76, y: 50 },
            '인도네시아': { x: 80, y: 58 }, 'Indonesia': { x: 80, y: 58 },
            
            // 오세아니아
            '호주': { x: 85, y: 75 }, 'Australia': { x: 85, y: 75 },
            
            // 전역
            'Global': { x: 50, y: 50 }
        };

        // 철통 날짜 파싱
        function parseDate(dateStr) {
            if (!dateStr) return new Date();
            const clean = dateStr.toString().replace(/\./g, '-').replace(/\s/g, '');
            const parts = clean.split('T')[0].split('-');
            return parts.length < 3 ? new Date() : new Date(parts[0], parts[1] - 1, parts[2]);
        }

        // 주차 계산 함수
        function getWeekOfMonth(date) {
            const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
            const dayOfMonth = date.getDate();
            const firstDayOfWeek = firstDay.getDay();
            return Math.ceil((dayOfMonth + firstDayOfWeek) / 7);
        }

        // 날짜 범위로 필터링
        function getDateRangeForWeek(year, month, weekNum) {
            const firstDay = new Date(year, month, 1);
            const firstDayOfWeek = firstDay.getDay();
            
            const startDate = (weekNum - 1) * 7 - firstDayOfWeek + 1;
            const endDate = startDate + 6;
            
            return {
                start: Math.max(1, startDate),
                end: Math.min(endDate, new Date(year, month + 1, 0).getDate())
            };
        }

        async function fetchNews() {
            try {
                const res = await fetch(GAS_URL);
                const json = await res.json();
                
                // 데이터 구조 호환성 처리
                if (Array.isArray(json)) {
                    allNews = json;
                    // 레거시: 시장 데이터가 없으면 기존 더미 데이터 사용 로직 유지
                    renderFXRates(); 
                    renderMaterialPrices();
                } else {
                    allNews = json.news || [];
                    const marketData = json.market || [];
                    
                    // 시장 데이터가 있으면 렌더링
                    if (marketData.length > 0) {
                        processAndRenderMarketData(marketData);
                    } else {
                        renderFXRates(); // Fallback
                        renderMaterialPrices();
                    }
                }

                console.log('Fetched news:', allNews.length, 'items');
                currentFilteredNews = [...allNews];
                renderAll(allNews);
                sortNews('latest'); 
            } catch(e) { 
                console.error('Fetch error:', e); 
                document.getElementById('loading').innerText = 'ERROR LOADING DATA';
            }
            document.getElementById('loading').style.display = 'none';
        }

        function processAndRenderMarketData(data) {
            // FX와 Material 분리
            fxData = data.filter(d => d.Category === 'FX').map(d => ({
                code: d.Title,
                value: d.Value,
                change: d.Change * 100, // 백분율로 변환
                name: d.Title, // 이름 매핑 필드 추가 가능
                timestamp: new Date().toLocaleTimeString('ko-KR')
            }));
            
            materialData = data.filter(d => d.Category === 'Material').map(d => ({
                name: d.Title,
                value: d.Value,
                unit: d.Unit,
                change: d.Change * 100,
                description: d.Title,
                timestamp: new Date().toLocaleTimeString('ko-KR')
            }));
            
            updateFXCarousel();
            updateMaterialCarousel();
        }

        // 초기 실행 시 (fetchNews 내부에서 호출되므로 onload 수정 필요 없음)
        // 기존 renderFXRates, renderMaterialPrices 함수는 Fallback용으로 유지하거나 삭제 가능
        // 아래는 Fallback용 (데이터 없을 때)
        async function renderFXRates() {
            if (fxData.length > 0) return; // 이미 데이터가 있으면 패스
            // ... (기존 더미/API 로직 유지) ...
            try {
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const data = await response.json();
                const krwRate = data.rates.KRW;
                const eurRate = data.rates.EUR;
                const jpyRate = data.rates.JPY;
                const cnyRate = data.rates.CNY;
                
                fxData = [
                    { 
                        code: 'USD/KRW', 
                        value: krwRate, 
                        change: 0, // No random change for fallback
                        name: '미국 달러',
                        timestamp: new Date().toLocaleTimeString('ko-KR')
                    },
                    { 
                        code: 'EUR/KRW', 
                        value: krwRate / eurRate, 
                        change: 0, // No random change for fallback
                        name: '유로',
                        timestamp: new Date().toLocaleTimeString('ko-KR')
                    },
                    { 
                        code: 'JPY/KRW', 
                        value: (krwRate / jpyRate) * 100, 
                        change: 0, // No random change for fallback
                        name: '일본 엔 (100엔)',
                        timestamp: new Date().toLocaleTimeString('ko-KR')
                    },
                    { 
                        code: 'CNY/KRW', 
                        value: krwRate / cnyRate, 
                        change: 0, // No random change for fallback
                        name: '중국 위안',
                        timestamp: new Date().toLocaleTimeString('ko-KR')
                    }
                ];
                updateFXCarousel();
            } catch (error) {
                console.error('FX API error:', error);
                // Fallback data if API fails
                fxData = [
                    { code: 'USD/KRW', value: 1340.50, change: 0, name: '미국 달러', timestamp: new Date().toLocaleTimeString('ko-KR') },
                    { code: 'EUR/KRW', value: 1450.20, change: 0, name: '유로', timestamp: new Date().toLocaleTimeString('ko-KR') },
                    { code: 'JPY/KRW', value: 9.45, change: 0, name: '일본 엔 (100엔)', timestamp: new Date().toLocaleTimeString('ko-KR') },
                    { code: 'CNY/KRW', value: 185.30, change: 0, name: '중국 위안', timestamp: new Date().toLocaleTimeString('ko-KR') }
                ];
                updateFXCarousel();
            }
        }

        async function renderMaterialPrices() {
             if (materialData.length > 0) return; // 이미 데이터가 있으면 패스
            // 실제 원자재 가격 (2026년 1월 기준 대략적인 시장 가격)
            materialData = [
                { 
                    name: 'Copper (Cu)', 
                    value: 9250, 
                    unit: 'USD/MT', 
                    change: 0, // No random change for fallback
                    description: '구리 (LME)',
                    timestamp: new Date().toLocaleTimeString('ko-KR')
                },
                { 
                    name: 'Aluminum (Al)', 
                    value: 2580, 
                    unit: 'USD/MT', 
                    change: +(Math.random() * 3 - 1.5).toFixed(2), 
                    description: '알루미늄 (LME)',
                    timestamp: new Date().toLocaleTimeString('ko-KR')
                },
                { 
                    name: 'R-134a', 
                    value: 8.5, 
                    unit: 'USD/kg', 
                    change: +(Math.random() * 2 - 1).toFixed(2), 
                    description: '냉매',
                    timestamp: new Date().toLocaleTimeString('ko-KR')
                },
                { 
                    name: 'ABS', 
                    value: 2100, 
                    unit: 'USD/MT', 
                    change: +(Math.random() * 2 - 1).toFixed(2), 
                    description: 'ABS 수지',
                    timestamp: new Date().toLocaleTimeString('ko-KR')
                },
                { 
                    name: 'HIPS', 
                    value: 1950, 
                    unit: 'USD/MT', 
                    change: +(Math.random() * 2 - 1).toFixed(2), 
                    description: 'HIPS',
                    timestamp: new Date().toLocaleTimeString('ko-KR')
                },
                { 
                    name: 'GI Steel', 
                    value: 950, 
                    unit: 'USD/MT', 
                    change: +(Math.random() * 3 - 1.5).toFixed(2), 
                    description: '아연도금강판',
                    timestamp: new Date().toLocaleTimeString('ko-KR')
                }
            ];
            
            updateMaterialCarousel();
        }
        
        function updateMaterialCarousel() {
            const carousel = document.getElementById('materialCarousel');
            const dots = document.getElementById('materialDots');
            
            carousel.innerHTML = materialData.map(mat => `
                <div class="market-slide">
                    <div>
                        <div class="market-label">${mat.name}</div>
                        <div style="font-size: 8px; color: #94a3b8;">${mat.description}</div>
                        <div style="font-size: 7px; color: #cbd5e1; margin-top: 2px;">${mat.timestamp}</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="market-value">$${mat.value.toLocaleString()}</div>
                        <div style="font-size: 8px; color: #64748b;">${mat.unit}</div>
                        <span class="market-change ${mat.change >= 0 ? 'market-up' : 'market-down'}">
                            ${mat.change >= 0 ? '▲' : '▼'} ${Math.abs(mat.change)}%
                        </span>
                    </div>
                </div>
            `).join('');
            
            dots.innerHTML = materialData.map((_, i) => 
                `<div class="carousel-dot ${i === materialCurrentIndex ? 'active' : ''}" onclick="goToMaterialSlide(${i})"></div>`
            ).join('');
            
            carousel.style.transform = `translateX(-${materialCurrentIndex * 100}%)`;
            
            // 자동 슬라이드
            if (materialInterval) clearInterval(materialInterval);
            materialInterval = setInterval(() => {
                materialCurrentIndex = (materialCurrentIndex + 1) % materialData.length;
                updateMaterialCarousel();
            }, 3000);
        }
        
        function goToMaterialSlide(index) {
            materialCurrentIndex = index;
            updateMaterialCarousel();
        }
        
        window.onload = () => { 
            lucide.createIcons(); 
            fetchNews();
            renderFXRates();
            renderMaterialPrices();
            
            // 1분마다 환율/원자재 데이터 업데이트
            setInterval(() => {
                renderFXRates();
                renderMaterialPrices();
            }, 60000);
        };
    </script>
</body>
</html>
